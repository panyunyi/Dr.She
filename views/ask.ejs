<!DOCTYPE html>
<html class="no-js drshe_wap" style="font-size: 37.5px;">

<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">

    <meta name="description" content="">
    <meta name="HandheldFriendly" content="True">
    <meta name="MobileOptimized" content="320">
    <meta name="format-detection" content="telephone=no">
    <meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1, maximum-scale=1">

    <title>快速提问</title>

    <link rel="shortcut icon" href="http://media2.chunyuyisheng.com/@/static/favicon.ico">

    <link rel="stylesheet" href="../stylesheets/cy1.css">
    <link rel="stylesheet" href="../stylesheets/ask.css">
    <link rel="stylesheet" href="../stylesheets/upgrade.css">
    <style>
        .age{
            margin-top: .26667rem;
            font-weight: lighter;
            font-size: .34667rem;
            color: #979797;
            margin-right: .21rem;
        }
    </style>
</head>

<body class="">

    <div class="partner-right">

        <section class="ask-description">
            <textarea autofocus="" id="description" placeholder="请上传妇科自检图像并详细描述您的症状疾病和身体状况，便于医生更准确的分析，星天使将确保您的隐私安全（字数限制为10~1000字）"></textarea>
            <span class="age">请填写年龄:</span><input style="width: 16%;height:22px" type="number" id="age" name="age" min="18" max="60" placeholder="年龄" />
        </section>

        <div class="img-list">
            <div class="line" style="position: relative;">

                <button class="img-container select" id="add-img">
                    <input multiple="multiple" style="font-size: 999px; opacity: 0; position: absolute; top: 0px; left: 0px; width: 100%; height: 100%;" type="file" name="iconImage" id="Image" accept="image/jpeg,image/png,image/gif,image/bmp">
                </button>
            </div>
            
        </div>
        <section class="service-section">
            <h3>三甲医院医生<span class="service-price">10点</span></h3>
            <h6>升级为三位主治及以上级别医生回复</h6>
            <span class="service-level-btn select" data-price="3" data-type="qc_doc_upgrade"></span>
        </section>
        <div class="toolbar">
            
            <button id="ask" class="btn" onclick="getNum(description.value)">提交</button>
            <p class="notice" style="float:left;margin-left:.5rem;text-decoration:underline">自检图像采集方法</p>
            <p class="notice">问诊服务由公立三甲、专科医生提供</p>
        </div>
    </div>

    <script src="https://cdn.bootcss.com/jquery/3.2.1/jquery.min.js"></script>
    <link rel="stylesheet" href="https://res.wx.qq.com/open/libs/weui/1.1.0/weui.min.css">
    <script type="text/javascript" src="../weui.js"></script>
    <script type="text/javascript">
        var sum=0;
        $('#Image').change(function (event) {
            if(sum>=3){
                weui.alert('只能上传3张图片');
                return;
            }
            /* Act on the event */
            if ($('#Image').val().length) {
                var fileName = $('#Image').val();
                var extension = fileName.substring(fileName.lastIndexOf('.'), fileName.length).toLowerCase();
                if (extension == ".jpg" || extension == ".png") {
                    var data = new FormData();
                    data.append('iconImage', $('#Image')[0].files[0]);
                    $.ajax({
                        url: '/ask/upload',
                        type: 'POST',
                        data: data,
                        cache: false,
                        contentType: false, //不可缺参数
                        processData: false, //不可缺参数
                        success: function (data) {
                            sum++;
                            $('#add-img').before('<div class="img-container"><img src="'+data.img+'"><span class="del"></span></div>');
                        },
                        error: function () {
                            console.log('error');
                        }
                    });
                }
            }
        });
        $(".img-list").on("click",".del",function(){
            var e=$(this);
            weui.dialog({
                title: '',
                content: '删除该图片？',
                className: 'custom-classname',
                buttons: [{
                    label: '取消',
                    type: 'default',
                    onClick: function () { alert('取消') }
                }, {
                    label: '确定',
                    type: 'primary',
                    onClick: function () { sum--;e.parents(".img-container").remove();}
                }]
            });
        });
        $('.service-level-btn').on("click",function(){
            if($('.service-level-btn').is('.select')){
                $('.service-level-btn.select').removeClass('select');
            }else{
                $('.service-level-btn').addClass('select');
            }
            
        });
        
        function getNum(str) {
            if($("#age").val().length<1){
                weui.alert('请输入年龄');
                return;
            }
            if (str.length >= 10 && str.length <= 1000) {
                var imglist='';
                $(".img-list img").each(function(i){
                    imglist+=$(this).attr("src")+",";
                });
                $.post("/ask/add", { content: $("#description").val(),age: $("#age").val(),"imglist":imglist }, function (result) {
                    if(result.id!=0){
                        window.location.replace("inquiry?id=" + result.id);
                    }else{
                        weui.alert("创建问题失败，请联系客服。")
                    }
                });
            } else {
                weui.alert('字数限制为10~1000');
            }
        }
    </script>
</body>

</html>