<!DOCTYPE html>
<html class="no-js drshe_wap" style="font-size: 37.5px;">

<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">

    <meta name="description" content="">
    <meta name="HandheldFriendly" content="True">
    <meta name="MobileOptimized" content="320">
    <meta name="format-detection" content="telephone=no">
    <meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1, maximum-scale=1">

    <title>快问医生</title>

    <link rel="shortcut icon" href="http://media2.chunyuyisheng.com/@/static/favicon.ico">

    <link rel="stylesheet" href="../stylesheets/cy1.css">
    <link rel="stylesheet" href="../stylesheets/ask.css">
    <link rel="stylesheet" href="../stylesheets/upgrade.css">
    <link rel="stylesheet" href="../stylesheets/choose.css">
    <style>
        .age {
            margin-top: .26667rem;
            font-weight: lighter;
            font-size: .34667rem;
            color: #979797;
            margin-right: .21rem;
        }

        header {
            background-color: #f4f4f4;
            font-size: .34667rem;
            padding: .26667rem .4rem;
            line-height: 1.2;
        }

        header span {
            color: #999;
            margin-right: 8%;
        }
    </style>
</head>

<body class="">

    <div id="html1" class="partner-right">
        <section class="ask-description">
            <textarea autofocus="" id="description" placeholder="请填写年龄和上传妇科自检图像，描述体症便于医生作准确的分析（字数限制为10~300字）"></textarea>
            <span class="age">请填写年龄:</span><input style="width: 16%;height:22px;border: 0px;font-size: .4rem;margin-bottom: .06rem;"
                type="number" id="age" name="age" min="18" max="60" placeholder="年龄" />
        </section>

        <div class="img-list">
            <div class="line" style="position: relative;">

                <button class="img-container select" id="add-img">
                    <input style="font-size: 999px; opacity: 0; position: absolute; top: 0px; left: 0px; width: 100%; height: 100%;" type="file" name="iconImage" id="Image" accept="image/jpeg,image/png,image/gif,image/bmp">
                </button>
            </div>

        </div>
        <div class="toolbar">

            <button id="ask" class="btn" onclick="getNum(description.value)">提交</button>
            <p class="notice" style="float:left;margin-left:.5rem;text-decoration:underline">如何采集图像</p>
            <p class="notice">(本服务由三甲、专科医生提供)</p>
        </div>
    </div>

    <!--<div id="html2" class="partner-right" style="display:none">
        <header>
            <span>您当前<%=points%>积分</span>
        </header>
        <div class="container">

            <div class="doctor-list appoint">
                <div class="doctor-list-left">
                    <div class="doctor-img">
                        <img src="../01.png">
                    </div>
                </div>
                <div class="doctor-list-right">
                    <div class="doctor-list-top">
                        <p class="doctor-name">系统指派医生</p>
                        <p class="hospital-name">三级甲等或专科医院（限20次对话）</p>
                    </div>
                    <div class="doctor-list-bottom">
                        <p class="price">2积分</p>
                        <span id="auto" class="square checked money_num"></span>
                    </div>
                </div>
            </div>
            <div class="doctor-list" style="border:0">
                <div class="doctor-list-left">
                    <a class="doctor-img" href="javascript:;">
                  <img src="../02.png">
              </a>
                </div>
                <div class="doctor-list-right">
                    <div class="doctor-list-top">
                        <p class="doctor-name">一题多问</p>
                        <p class="hospital-name">将问题同时发送给3名医生咨询
                        </p>
                    </div>
                    <div class="doctor-list-bottom">
                        <p class="price">5积分</p>

                        <span id="three" class="square money_num"></span>

                    </div>
                </div>
            </div>
        </div>
        <section class="upgrade-btn-wrap">
            <div class="upgrade-btn">提交</div>
        </section>
    </div>-->
    <script src="https://cdn.bootcss.com/jquery/3.2.1/jquery.min.js"></script>
    <link rel="stylesheet" href="https://res.wx.qq.com/open/libs/weui/1.1.0/weui.min.css">
    <script type="text/javascript" src="../weui.js"></script>
    <script type="text/javascript">
        var sum = 0;

        var points = <%=points%>
            $('#Image').change(function (event) {
                if (sum >= 3) {
                    weui.alert('只能上传3张图片');
                    return;
                }
                /* Act on the event */
                if ($('#Image').val().length) {
                    var fileName = $('#Image').val();
                    var extension = fileName.substring(fileName.lastIndexOf('.'), fileName.length).toLowerCase();
                    if (extension == ".jpg" || extension == ".png") {
                        var data = new FormData();
                        data.append('iconImage', $('#Image')[0].files[0]);
                        var loading = weui.loading('正在上传图片...', {
                            className: 'custom-classname'
                        });
                        $.ajax({
                            url: '/ask/upload',
                            type: 'POST',
                            data: data,
                            cache: false,
                            contentType: false, //不可缺参数
                            processData: false, //不可缺参数
                            success: function (data) {
                                loading.hide();
                                sum++;
                                $('#add-img').before('<div class="img-container"><img src="' + data.img + '"><span class="del"></span></div>');
                            },
                            error: function () {
                                console.log('error');
                            }
                        });
                    }
                }
            });
        $(".img-list").on("click", ".del", function () {
            var e = $(this);
            weui.dialog({
                title: '',
                content: '删除该图片？',
                className: 'custom-classname',
                buttons: [{
                    label: '取消',
                    type: 'default',
                    onClick: function () {  }
                }, {
                    label: '确定',
                    type: 'primary',
                    onClick: function () { sum--; e.parents(".img-container").remove(); }
                }]
            });
        });
        $('.service-level-btn').on("click", function () {
            if ($('.service-level-btn').is('.select')) {
                $('.service-level-btn.select').removeClass('select');
            } else {
                $('.service-level-btn').addClass('select');
            }

        });
        var imglist = '';
        function getNum(str) {
            if ($("#age").val().length < 1) {
                weui.alert('请输入年龄');
                return;
            }
            if (str.length >= 10 && str.length <= 1000) {
                var imglist = '';
                $(".img-list img").each(function (i) {
                    imglist += $(this).attr("src") + ",";
                });
                // $('#html1').css('display', 'none');
                // $('#html2').css('display', 'block');
                var num = 2;
                if ($('#three').hasClass('checked')) {
                    num = 5;
                }
                if (points < num) {
                    window.location.replace("pay?points=" + num);
                    return;
                }
                $.post("/ask/add", { content: $("#description").val(), age: $("#age").val(), imglist: imglist, num: num }, function (result) {
                    if (result.id != 0) {
                        window.location.replace("inquiry?id=" + result.id);
                    } else {
                        weui.alert("创建问题失败，请联系客服。")
                    }
                });
            } else {
                weui.alert('字数限制为10~1000');
            }
        }
        // $(".upgrade-btn").on("click", function () {
        //     var num = 2;
        //     if ($('#three').hasClass('checked')) {
        //         num = 5;
        //     }
        //     if (points < num) {
        //         window.location.replace("pay?points=" + num);
        //         return;
        //     }
        //     $.post("/ask/add", { content: $("#description").val(), age: $("#age").val(), imglist: imglist, num: num }, function (result) {
        //         if (result.id != 0) {
        //             window.location.replace("inquiry?id=" + result.id);
        //         } else {
        //             weui.alert("创建问题失败，请联系客服。")
        //         }
        //     });
        // });
        // $("#auto").on("click", function () {
        //     $("#auto").addClass("checked");
        //     $('#three').removeClass("checked");
        // });
        // $("#three").on("click", function () {
        //     $("#three").addClass("checked");
        //     $('#auto').removeClass("checked");
        // });
    </script>
</body>

</html>