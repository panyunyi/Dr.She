<!DOCTYPE html>
<html class="no-js drshe_wap" style="font-size: 37.5px;">

<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">

    <meta name="description" content="">
    <meta name="HandheldFriendly" content="True">
    <meta name="MobileOptimized" content="320">
    <meta name="format-detection" content="telephone=no">
    <meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1, maximum-scale=1">

    <title>快问医生</title>

    <link rel="shortcut icon" href="http://media2.chunyuyisheng.com/@/static/favicon.ico">
    <link rel="stylesheet" href="assets/css/amazeui.min.css">
    <link rel="stylesheet" href="assets/css/app.css">
    <link rel="stylesheet" href="../stylesheets/cy1.css">
    <link rel="stylesheet" href="../stylesheets/ask.css">


    <style>
        .age {
            margin-top: .26667rem;
            margin-right: .21rem;
        }

        .toolbar {
            height: 0
        }

        .ask-description p {
            font-size: .42667rem;
            margin-bottom: .2rem;
        }

        .ask-description textarea {
            border-bottom: 2px solid #eee !important;
        }

        .age {
            font-size: .42667rem;
            border-bottom: 2px solid #eee !important;
            padding-bottom: .4rem;
            width: 100%;
        }

        .img-list p {
            font-size: .42667rem;
            margin-bottom: .2rem;
        }

        .am-modal-dialog {
            background: #fff
        }

        .am-modal-bd p {
            font-size: .42667rem;
        }

        .img-back1 {
            FILTER: progid:DXImageTransform.Microsoft.Gradient(gradientType=0, startColorStr=#b8c4cb, endColorStr=red);
            /*IE 6 7 8*/
            background: -ms-linear-gradient(top, #fff, #e9f8ff);
            /* IE 10 */
            background: -moz-linear-gradient(top, #b8c4cb, #f6f6f8);
            /*火狐*/
            background: -webkit-gradient(linear, 0% 0%, 0% 100%, from(#b8c4cb), to(#f6f6f8));
            /*谷歌*/
            background: -webkit-gradient(linear, 0% 0%, 0% 100%, from(#fff), to(#e9f8ff));
            /* Safari 4-5, Chrome 1-9*/
            background: -webkit-linear-gradient(top, #fff, #e9f8ff);
            /*Safari5.1 Chrome 10+*/
            background: -o-linear-gradient(top, #fff, #e9f8ff);
            /*Opera 11.10+*/
        }

        .img-back2 {
            FILTER: progid:DXImageTransform.Microsoft.Gradient(gradientType=0, startColorStr=#b8c4cb, endColorStr=red);
            /*IE 6 7 8*/
            background: -ms-linear-gradient(top, #fff, #f0ffe8);
            /* IE 10 */
            background: -moz-linear-gradient(top, #b8c4cb, #f6f6f8);
            /*火狐*/
            background: -webkit-gradient(linear, 0% 0%, 0% 100%, from(#b8c4cb), to(#f6f6f8));
            /*谷歌*/
            background: -webkit-gradient(linear, 0% 0%, 0% 100%, from(#fff), to(#f0ffe8));
            /* Safari 4-5, Chrome 1-9*/
            background: -webkit-linear-gradient(top, #fff, #f0ffe8);
            /*Safari5.1 Chrome 10+*/
            background: -o-linear-gradient(top, #fff, #f0ffe8);
            /*Opera 11.10+*/
        }
    </style>
</head>

<body class="">

    <div id="html1" class="partner-right">
        <%if (hasheader){%>
            <header>
                <div class="block-left">
                    <a href="http://weixin.chunyuyisheng.com/cooperation/wap/doctor/identified_info_page/?doctor_id=<%=doctor_id%>&partner=chunyu_wap">
            <img src="<%=image%>" class="doctor-avatar-small">
        </a>
                </div>
                <div class="block-right">
                    <h6 class="doctor-title-small">
                        <%=name%><span><%=hospital%></span></h6>
                    <span class="doctor-label"><%=clinic%></span><span class="doctor-label"><%=title%></span>
                </div>
            </header>
            <%}%>

                <section class="ask-description">
                    <p>描述体症：</p>
                    <textarea autofocus="" id="description" placeholder="便于医生做出准确分析，字数限制为10~300字"></textarea>
                    <p class="age">请填写年龄：<input style="width: 16%;height:22px;border: 0px;font-size: .42667rem;margin-bottom: .06rem;" type="number"
                            id="age" name="age" min="18" max="60" placeholder="年龄" /></p>
                </section>

                <div class="img-list">
                    <div class="line" style="position: relative;">
                        <p>添加照片：<span style="color:#ccc">必填</span></p>
                        <button class="img-container select" id="add-img">
                    <input style="font-size: 999px; opacity: 0; position: absolute; top: 0px; left: 0px; width: 100%; height: 100%;" type="file" name="iconImage" id="Image" accept="image/jpeg,image/jpg,image/png,image/gif,image/bmp">
                </button>
                    </div>

                </div>
                <div class="toolbar">

                    <button id="ask" class="btn" onclick="getNum(description.value)">提交</button>
                    <a href="#" class="notice" style="float:left;margin-left:.5rem;text-decoration:underline" data-am-modal="{target: '#doc-modal-1', closeViaDimmer: 0, width: 300, height: 226}">如何采集图像</a>
                    <p class="notice">(本服务由三甲、专科医生提供)</p>
                </div>
                <div class="am-modal am-modal-no-btn" tabindex="-1" id="doc-modal-1">

                    <div class="am-modal-dialog">
                        <div class="am-modal-hd">
                            <a href="javascript: void(0)" class="am-close am-close-spin" data-am-modal-close>&times;</a>
                        </div>
                        <div class="am-modal-bd">
                            <div style="border-bottom:1px solid #ccc">
                                <p id="tab1" style="float:left;display:inline;margin-left:1rem;border-right:1px solid #ccc;padding-right:.7rem;color:#01669c">扩阴器自检</p>
                                <p id="tab2" style="display:inline;color:#ccc">视检镜自检</p>
                            </div>
                            <div class="img-back1">
                                <img class="am-img-responsive" src="assets/i/kuoyinqi.png">
                            </div>
                            <div style="display:none" class="img-back2">
                                <img class="am-img-responsive" src="assets/i/shijianjing.png">
                            </div>
                        </div>
                    </div>

                </div>
    </div>

    <script src="../jquery.min.js"></script>
    <script src="assets/js/amazeui.min.js"></script>
    <link rel="stylesheet" href="../weui.min.css">
    <script type="text/javascript" src="../weui.js"></script>
    <script type="text/javascript">
        var sum = 0;
        var points = <%=points%>;
        $('#tab1').on('click', function () {
            $('#tab1').css('color', '#01669c');
            $('#tab2').css('color', '#ccc');
            $('.img-back1').css('display', 'block');
            $('.img-back2').css('display', 'none');
        });
        $('#tab2').on('click', function () {
            $('#tab1').css('color', '#ccc');
            $('#tab2').css('color', '#249859');
            $('.img-back2').css('display', 'block');
            $('.img-back1').css('display', 'none');
        });
        $('#Image').change(function (event) {
            if ($(".img-list img").length == 3) {
                weui.alert('只能上传3张图片');
                return;
            }
            /* Act on the event */
            //weui.alert($('#Image').val().length);
            if ($('#Image').val().length) {
                var fileName = $('#Image').val();
                var extension = fileName.substring(fileName.lastIndexOf('.'), fileName.length).toLowerCase();
                //if (extension == ".jpg" || extension == ".png") {
                    var data = new FormData();
                    data.append('iconImage', $('#Image')[0].files[0]);
                    var loading = weui.loading('正在上传图片...', {
                        className: 'custom-classname'
                    });
                    $.ajax({
                        url: '/ask/upload',
                        type: 'POST',
                        data: data,
                        cache: false,
                        contentType: false, //不可缺参数
                        processData: false, //不可缺参数
                        success: function (data) {
                            loading.hide();
                            sum++;
                            if (sum == 3) {
                                return;
                            } else {
                                $('#add-img').before('<div class="img-container"><img src="' + data.img + '"><span class="del"></span></div>');
                            }
                        },
                        error: function () {
                            console.log('error');
                        }
                    });
                //}
            }
        });
        $(".img-list").on("click", ".del", function () {
            var e = $(this);
            weui.dialog({
                title: '',
                content: '删除该图片？',
                className: 'custom-classname',
                buttons: [{
                    label: '取消',
                    type: 'default',
                    onClick: function () { }
                }, {
                    label: '确定',
                    type: 'primary',
                    onClick: function () { sum--; e.parents(".img-container").remove(); }
                }]
            });
        });
        $('.service-level-btn').on("click", function () {
            if ($('.service-level-btn').is('.select')) {
                $('.service-level-btn.select').removeClass('select');
            } else {
                $('.service-level-btn').addClass('select');
            }

        });

        function getNum(str) {
            if ($("#age").val().length < 1) {
                weui.alert('请输入年龄');
                return;
            }
            if(sum<=0){
                weui.alert('请上传自检图片');
                return;
            }
            if (str.length >= 10 && str.length <= 300) {
                var imglist = '';
                $(".img-list img").each(function (i) {
                    imglist += $(this).attr("src") + ",";
                });

                var num = 2;

                if (points < num) {
                    
                    window.location.replace("pay?points=" + num);
                    return;
                }
                $("#ask").attr('disabled','disabled');
                $.post("/ask/add/free", { content: $("#description").val(), age: $("#age").val(), imglist: imglist, num: num }, function (result) {
                    if (result.id != 0) {
                        window.location.replace("inquiry?id=" + result.id);
                    } else {
                        weui.alert("创建问题失败，请联系客服。")
                    }
                });
            } else {
                weui.alert('字数限制为10~300');
            }
        }
    </script>
</body>

</html>